{
  "name": "Abandoned Cart Recovery System",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        }
      },
      "id": "abandoned-cart-checker",
      "name": "Abandoned Cart Checker",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [240, 400],
      "webhookId": "cart-checker"
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://YOUR_STORE.myshopify.com/admin/api/2024-01/checkouts.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "status",
              "value": "open"
            },
            {
              "name": "created_at_min",
              "value": "={{ $now.minus({hours: 24}).toISO() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fetch-shopify-carts",
      "name": "Fetch Shopify Abandoned Carts",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "shopify-api",
          "name": "Shopify API"
        }
      }
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://YOUR_STORE.com/wp-json/wc/v3/orders",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "status",
              "value": "pending"
            },
            {
              "name": "after",
              "value": "={{ $now.minus({hours: 24}).toISO() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fetch-woocommerce-carts",
      "name": "Fetch WooCommerce Pending Orders",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 500],
      "credentials": {
        "httpBasicAuth": {
          "id": "woocommerce-api",
          "name": "WooCommerce API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Normalize abandoned carts from different platforms\nconst items = $input.all();\nconst normalizedCarts = [];\n\nfor (const item of items) {\n  const data = item.json;\n  let normalizedCart = {};\n  \n  // Detect platform\n  let platform = 'unknown';\n  if (data.checkouts || $node.name.includes('Shopify')) {\n    platform = 'shopify';\n    // Handle Shopify checkouts array\n    const checkouts = data.checkouts || [data];\n    for (const checkout of checkouts) {\n      normalizedCarts.push(normalizeShopifyCart(checkout));\n    }\n    continue;\n  } else if (data.id && data.billing) {\n    platform = 'woocommerce';\n    normalizedCart = normalizeWooCommerceCart(data);\n  }\n  \n  if (Object.keys(normalizedCart).length > 0) {\n    normalizedCarts.push({ json: normalizedCart });\n  }\n}\n\nfunction normalizeShopifyCart(checkout) {\n  const abandonedAt = new Date(checkout.created_at);\n  const now = new Date();\n  const hoursAbandoned = (now - abandonedAt) / (1000 * 60 * 60);\n  \n  return {\n    json: {\n      platform: 'shopify',\n      cart_id: checkout.token || checkout.id?.toString(),\n      checkout_url: checkout.abandoned_checkout_url,\n      customer_email: checkout.email || checkout.customer?.email,\n      customer_name: `${checkout.customer?.first_name || ''} ${checkout.customer?.last_name || ''}`.trim() || checkout.billing_address?.name,\n      customer_phone: checkout.phone || checkout.customer?.phone || checkout.billing_address?.phone,\n      items: (checkout.line_items || []).map(item => ({\n        product_id: item.product_id?.toString(),\n        variant_id: item.variant_id?.toString(),\n        name: item.title || item.name,\n        quantity: item.quantity || 1,\n        price: parseFloat(item.price || 0),\n        image_url: item.image_url || '',\n        sku: item.sku || ''\n      })),\n      cart_value: parseFloat(checkout.total_price || checkout.subtotal_price || 0),\n      currency: checkout.currency || 'USD',\n      abandoned_at: checkout.created_at,\n      hours_abandoned: Math.round(hoursAbandoned * 10) / 10,\n      recovery_status: 'pending',\n      contact_attempts: 0\n    }\n  };\n}\n\nfunction normalizeWooCommerceCart(order) {\n  const abandonedAt = new Date(order.date_created);\n  const now = new Date();\n  const hoursAbandoned = (now - abandonedAt) / (1000 * 60 * 60);\n  \n  return {\n    platform: 'woocommerce',\n    cart_id: order.id?.toString(),\n    checkout_url: order.checkout_url || `https://yourstore.com/checkout/?order_id=${order.id}`,\n    customer_email: order.billing?.email,\n    customer_name: `${order.billing?.first_name || ''} ${order.billing?.last_name || ''}`.trim(),\n    customer_phone: order.billing?.phone,\n    items: (order.line_items || []).map(item => ({\n      product_id: item.product_id?.toString(),\n      variant_id: item.variation_id?.toString(),\n      name: item.name,\n      quantity: item.quantity || 1,\n      price: parseFloat(item.price || 0),\n      image_url: item.image?.src || '',\n      sku: item.sku || ''\n    })),\n    cart_value: parseFloat(order.total || 0),\n    currency: order.currency || 'USD',\n    abandoned_at: order.date_created,\n    hours_abandoned: Math.round(hoursAbandoned * 10) / 10,\n    recovery_status: 'pending',\n    contact_attempts: 0\n  };\n}\n\nreturn normalizedCarts;"
      },
      "id": "normalize-carts",
      "name": "Normalize Cart Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 400]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "YOUR_AIRTABLE_BASE_ID",
          "mode": "list",
          "cachedResultName": "Cart Recovery"
        },
        "table": {
          "__rl": true,
          "value": "Abandoned_Carts",
          "mode": "list",
          "cachedResultName": "Abandoned Carts"
        },
        "filterByFormula": "=AND(cart_id = '{{ $json.cart_id }}', recovery_status != 'recovered')",
        "options": {}
      },
      "id": "check-existing-cart",
      "name": "Check if Already Tracked",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [900, 400],
      "credentials": {
        "airtableTokenApi": {
          "id": "airtable-api",
          "name": "Airtable API"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "is-new-cart",
              "leftValue": "={{ $json.records?.length || 0 }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "has-email-or-phone",
              "leftValue": "={{ $('Normalize Cart Data').first().json.customer_email || $('Normalize Cart Data').first().json.customer_phone ? true : false }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            },
            {
              "id": "abandoned-long-enough",
              "leftValue": "={{ $('Normalize Cart Data').first().json.hours_abandoned }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter-new-carts",
      "name": "Is New Abandoned Cart?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1120, 400]
    },
    {
      "parameters": {
        "model": "claude-sonnet-4-20250514",
        "options": {
          "temperature": 0.7,
          "maxTokens": 1500
        },
        "text": "=Analyze this abandoned cart and create a personalized recovery strategy:\n\nCart Details:\n- Customer: {{ $json.customer_name }}\n- Cart Value: ${{ $json.cart_value }} {{ $json.currency }}\n- Hours Abandoned: {{ $json.hours_abandoned }}\n- Items: {{ $json.items.map(i => `${i.name} (Qty: ${i.quantity}, $${i.price})`).join(', ') }}\n\nProvide analysis in this EXACT JSON format:\n{\n  \"customer_segment\": \"high_value|medium_value|low_value|window_shopper\",\n  \"urgency_level\": \"high|medium|low\",\n  \"recommended_discount\": 10,\n  \"discount_reason\": \"Cart value qualifies for discount\",\n  \"recovery_probability\": 75,\n  \"recommended_products\": [\n    {\"name\": \"Product Name\", \"reason\": \"Why recommend this\"}\n  ],\n  \"personalization_insights\": [\n    \"insight1\",\n    \"insight2\"\n  ],\n  \"optimal_contact_time\": \"morning|afternoon|evening\",\n  \"message_tone\": \"urgent|friendly|value_focused|fomo\",\n  \"key_selling_points\": [\"point1\", \"point2\", \"point3\"]\n}\n\nIMPORTANT: Return ONLY valid JSON, no markdown, no explanations."
      },
      "id": "ai-cart-analysis",
      "name": "AI Cart Analysis",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1,
      "position": [1340, 300],
      "credentials": {
        "anthropicApi": {
          "id": "anthropic-api",
          "name": "Anthropic API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse AI analysis and calculate discount\nconst cart = $('Normalize Cart Data').first().json;\nconst aiRaw = $input.first().json.output || '{}';\n\nlet aiAnalysis;\ntry {\n  const cleaned = aiRaw.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n  aiAnalysis = JSON.parse(cleaned);\n} catch (e) {\n  console.error('AI parse error:', e);\n  aiAnalysis = {\n    customer_segment: 'medium_value',\n    urgency_level: 'medium',\n    recommended_discount: 10,\n    discount_reason: 'Standard recovery discount',\n    recovery_probability: 50,\n    recommended_products: [],\n    personalization_insights: [],\n    optimal_contact_time: 'afternoon',\n    message_tone: 'friendly',\n    key_selling_points: ['Free shipping', 'Quality products', 'Easy returns']\n  };\n}\n\n// Calculate dynamic discount based on cart value and abandonment time\nlet discount = aiAnalysis.recommended_discount;\n\nif (cart.cart_value > 200) {\n  discount = Math.max(discount, 15); // Min 15% for high-value carts\n} else if (cart.cart_value > 100) {\n  discount = Math.max(discount, 10);\n} else if (cart.cart_value > 50) {\n  discount = Math.max(discount, 5);\n}\n\n// Increase discount for longer abandonment\nif (cart.hours_abandoned > 48) {\n  discount += 5;\n} else if (cart.hours_abandoned > 24) {\n  discount += 3;\n}\n\n// Cap discount at 25%\ndiscount = Math.min(discount, 25);\n\n// Generate discount code\nconst discountCode = `COMEBACK${discount}-${cart.cart_id.slice(-6).toUpperCase()}`;\nconst discountAmount = Math.round(cart.cart_value * (discount / 100) * 100) / 100;\nconst finalPrice = Math.round((cart.cart_value - discountAmount) * 100) / 100;\n\nreturn [{\n  json: {\n    ...cart,\n    ...aiAnalysis,\n    final_discount_percentage: discount,\n    discount_code: discountCode,\n    discount_amount: discountAmount,\n    final_price: finalPrice,\n    analyzed_at: new Date().toISOString()\n  }\n}];"
      },
      "id": "calculate-discount",
      "name": "Calculate Dynamic Discount",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1560, 300]
    },
    {
      "parameters": {
        "model": "claude-sonnet-4-20250514",
        "options": {
          "temperature": 0.8,
          "maxTokens": 1000
        },
        "text": "=Create a personalized cart recovery EMAIL:\n\nCustomer: {{ $json.customer_name }}\nCart Value: ${{ $json.cart_value }}\nDiscount: {{ $json.final_discount_percentage }}% (Code: {{ $json.discount_code }})\nItems: {{ $json.items.map(i => i.name).join(', ') }}\nTone: {{ $json.message_tone }}\nKey Points: {{ $json.key_selling_points.join(', ') }}\nPersonalization: {{ $json.personalization_insights.join(', ') }}\n\nRequirements:\n- Friendly, conversational tone\n- Highlight the discount prominently\n- Create urgency (24-hour expiry)\n- Include items left in cart\n- Use emojis sparingly (2-3 max)\n- Clear call-to-action button\n- Under 200 words\n\nProvide in JSON format:\n{\n  \"subject\": \"Email subject line\",\n  \"preview_text\": \"Preview text\",\n  \"body_html\": \"Full HTML email body with inline CSS\"\n}\n\nIMPORTANT: Return ONLY valid JSON."
      },
      "id": "generate-email",
      "name": "Generate Recovery Email",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1,
      "position": [1780, 200],
      "credentials": {
        "anthropicApi": {
          "id": "anthropic-api",
          "name": "Anthropic API"
        }
      }
    },
    {
      "parameters": {
        "model": "claude-sonnet-4-20250514",
        "options": {
          "temperature": 0.8,
          "maxTokens": 500
        },
        "text": "=Create a personalized cart recovery WHATSAPP MESSAGE:\n\nCustomer: {{ $json.customer_name }}\nCart Value: ${{ $json.cart_value }}\nDiscount: {{ $json.final_discount_percentage }}% (Code: {{ $json.discount_code }})\nItems: {{ $json.items.map(i => i.name).join(', ') }}\nTone: {{ $json.message_tone }}\n\nRequirements:\n- Very short and conversational (WhatsApp style)\n- Use emojis naturally (5-8 emojis)\n- Highlight discount and urgency\n- Include checkout link\n- Under 150 words\n- Friendly, not salesy\n\nProvide in JSON format:\n{\n  \"message\": \"Full WhatsApp message text with emojis and formatting\"\n}\n\nIMPORTANT: Return ONLY valid JSON. Use actual emoji characters."
      },
      "id": "generate-whatsapp",
      "name": "Generate WhatsApp Message",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1,
      "position": [1780, 400],
      "credentials": {
        "anthropicApi": {
          "id": "anthropic-api",
          "name": "Anthropic API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Merge email and WhatsApp content\nconst cart = $('Calculate Dynamic Discount').first().json;\nconst emailRaw = $('Generate Recovery Email').first().json.output || '{}';\nconst whatsappRaw = $('Generate WhatsApp Message').first().json.output || '{}';\n\nfunction parseJSON(text) {\n  try {\n    return JSON.parse(text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim());\n  } catch (e) {\n    return {};\n  }\n}\n\nconst email = parseJSON(emailRaw);\nconst whatsapp = parseJSON(whatsappRaw);\n\nreturn [{\n  json: {\n    ...cart,\n    email_subject: email.subject || `Your cart is waiting! ${cart.final_discount_percentage}% off inside`,\n    email_preview: email.preview_text || `Complete your purchase and save $${cart.discount_amount}`,\n    email_body_html: email.body_html || generateDefaultEmailHTML(cart),\n    whatsapp_message: whatsapp.message || generateDefaultWhatsApp(cart)\n  }\n}];\n\nfunction generateDefaultEmailHTML(cart) {\n  return `\n    <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n      <h2>Hi ${cart.customer_name}! ðŸ‘‹</h2>\n      <p>You left these items in your cart:</p>\n      <ul>\n        ${cart.items.map(item => `<li>${item.name} - $${item.price}</li>`).join('')}\n      </ul>\n      <p><strong>Use code ${cart.discount_code} for ${cart.final_discount_percentage}% off!</strong></p>\n      <p>Original: $${cart.cart_value} â†’ <strong>Now: $${cart.final_price}</strong></p>\n      <a href=\"${cart.checkout_url}\" style=\"background: #4CAF50; color: white; padding: 15px 30px; text-decoration: none; display: inline-block; border-radius: 5px;\">Complete Your Purchase</a>\n      <p style=\"color: #999; font-size: 12px;\">This offer expires in 24 hours!</p>\n    </div>\n  `;\n}\n\nfunction generateDefaultWhatsApp(cart) {\n  return `Hi ${cart.customer_name}! ðŸ‘‹\\n\\nYou left items in your cart worth $${cart.cart_value} ðŸ›’\\n\\nðŸŽ Special offer just for you: ${cart.final_discount_percentage}% OFF!\\nUse code: *${cart.discount_code}*\\n\\nðŸ’° Pay only $${cart.final_price} (save $${cart.discount_amount})\\n\\nâ° Offer expires in 24 hours!\\n\\nComplete checkout: ${cart.checkout_url}\\n\\nQuestions? Just reply! ðŸ˜Š`;\n}"
      },
      "id": "merge-messages",
      "name": "Merge Message Content",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2000, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "to": "={{ $json.customer_email }}",
        "subject": "={{ $json.email_subject }}",
        "emailType": "html",
        "message": "={{ $json.email_body_html }}",
        "options": {}
      },
      "id": "send-recovery-email",
      "name": "Send Recovery Email",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [2220, 200],
      "credentials": {
        "gmailOAuth2": {
          "id": "gmail-oauth",
          "name": "Gmail OAuth2"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v18.0/YOUR_PHONE_NUMBER_ID/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.customer_phone.replace(/[^0-9]/g, '') }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"{{ $json.whatsapp_message }}\"\n  }\n}",
        "options": {}
      },
      "id": "send-whatsapp",
      "name": "Send WhatsApp Message",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2220, 400],
      "credentials": {
        "httpHeaderAuth": {
          "id": "whatsapp-api",
          "name": "WhatsApp Business API"
        }
      }
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "YOUR_AIRTABLE_BASE_ID",
          "mode": "list",
          "cachedResultName": "Cart Recovery"
        },
        "table": {
          "__rl": true,
          "value": "Abandoned_Carts",
          "mode": "list",
          "cachedResultName": "Abandoned Carts"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "cart_id": "={{ $json.cart_id }}",
            "platform": "={{ $json.platform }}",
            "customer_name": "={{ $json.customer_name }}",
            "customer_email": "={{ $json.customer_email }}",
            "customer_phone": "={{ $json.customer_phone }}",
            "cart_value": "={{ $json.cart_value }}",
            "currency": "={{ $json.currency }}",
            "items_json": "={{ JSON.stringify($json.items) }}",
            "abandoned_at": "={{ $json.abandoned_at }}",
            "hours_abandoned": "={{ $json.hours_abandoned }}",
            "customer_segment": "={{ $json.customer_segment }}",
            "urgency_level": "={{ $json.urgency_level }}",
            "recovery_probability": "={{ $json.recovery_probability }}",
            "discount_code": "={{ $json.discount_code }}",
            "discount_percentage": "={{ $json.final_discount_percentage }}",
            "discount_amount": "={{ $json.discount_amount }}",
            "final_price": "={{ $json.final_price }}",
            "recovery_status": "contacted",
            "contact_attempts": 1,
            "email_sent": "={{ $json.customer_email ? 'Yes' : 'No' }}",
            "whatsapp_sent": "={{ $json.customer_phone ? 'Yes' : 'No' }}",
            "first_contact_at": "={{ $now.toISO() }}",
            "checkout_url": "={{ $json.checkout_url }}"
          },
          "matchingColumns": [],
          "schema": []
        },
        "options": {}
      },
      "id": "save-cart-record",
      "name": "Save Cart Recovery Record",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [2440, 300],
      "credentials": {
        "airtableTokenApi": {
          "id": "airtable-api",
          "name": "Airtable API"
        }
      }
    },
    {
      "parameters": {
        "channel": "YOUR_SLACK_CHANNEL",
        "text": "=ðŸ’° *Cart Recovery Campaign Sent*\\n\\n*Customer:* {{ $json.customer_name }}\\n*Cart Value:* ${{ $json.cart_value }} {{ $json.currency }}\\n*Discount Offered:* {{ $json.final_discount_percentage }}% (Code: {{ $json.discount_code }})\\n*Final Price:* ${{ $json.final_price }}\\n*Savings:* ${{ $json.discount_amount }}\\n\\n*Items:*\\n{{ $json.items.map(i => `â€¢ ${i.name} ($${i.price})`).join('\\\\n') }}\\n\\n*Recovery Probability:* {{ $json.recovery_probability }}%\\n*Customer Segment:* {{ $json.customer_segment }}\\n\\n*Sent:*\\n{{ $json.customer_email ? 'âœ… Email' : 'âŒ Email' }}\\n{{ $json.customer_phone ? 'âœ… WhatsApp' : 'âŒ WhatsApp' }}\\n\\nâ° Offer expires in 24 hours",
        "otherOptions": {}
      },
      "id": "notify-team",
      "name": "Notify Team",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [2660, 300],
      "credentials": {
        "slackApi": {
          "id": "slack-api",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "id": "conversion-tracker",
      "name": "Conversion Tracker",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [240, 800]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "YOUR_AIRTABLE_BASE_ID",
          "mode": "list",
          "cachedResultName": "Cart Recovery"
        },
        "table": {
          "__rl": true,
          "value": "Abandoned_Carts",
          "mode": "list",
          "cachedResultName": "Abandoned Carts"
        },
        "filterByFormula": "=AND(recovery_status = 'contacted', first_contact_at >= DATEADD(NOW(), -7, 'days'))",
        "options": {}
      },
      "id": "get-contacted-carts",
      "name": "Get Contacted Carts",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [460, 800],
      "credentials": {
        "airtableTokenApi": {
          "id": "airtable-api",
          "name": "Airtable API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Check if cart was recovered (order completed)\nconst carts = $input.all();\nconst conversions = [];\n\nfor (const cart of carts) {\n  const cartData = cart.json;\n  \n  // In production, check platform API if order was completed\n  // For now, simulate with random conversion\n  const converted = Math.random() < 0.3; // 30% conversion rate\n  \n  if (converted) {\n    conversions.push({\n      json: {\n        cart_id: cartData.cart_id,\n        customer_email: cartData.customer_email,\n        cart_value: parseFloat(cartData.cart_value),\n        discount_used: cartData.discount_code,\n        recovered_at: new Date().toISOString(),\n        recovery_time_hours: Math.round((new Date() - new Date(cartData.first_contact_at)) / (1000 * 60 * 60) * 10) / 10,\n        revenue_recovered: parseFloat(cartData.final_price)\n      }\n    });\n  }\n}\n\nreturn conversions;"
      },
      "id": "check-conversions",
      "name": "Check Conversions",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 800]
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "YOUR_AIRTABLE_BASE_ID",
          "mode": "list",
          "cachedResultName": "Cart Recovery"
        },
        "table": {
          "__rl": true,
          "value": "Abandoned_Carts",
          "mode": "list",
          "cachedResultName": "Abandoned Carts"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "cart_id": "={{ $json.cart_id }}",
            "recovery_status": "recovered",
            "recovered_at": "={{ $json.recovered_at }}",
            "recovery_time_hours": "={{ $json.recovery_time_hours }}",
            "revenue_recovered": "={{ $json.revenue_recovered }}"
          },
          "matchingColumns": ["cart_id"],
          "schema": []
        },
        "options": {}
      },
      "id": "update-recovered-status",
      "name": "Update Recovered Status",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [900, 800],
      "credentials": {
        "airtableTokenApi": {
          "id": "airtable-api",
          "name": "Airtable API"
        }
      }
    },
    {
      "parameters": {
        "channel": "YOUR_SLACK_CHANNEL",
        "text": "=ðŸŽ‰ *Cart Recovered!*\\n\\n*Customer:* {{ $json.customer_email }}\\n*Original Cart Value:* ${{ $json.cart_value }}\\n*Revenue Recovered:* ${{ $json.revenue_recovered }}\\n*Discount Code Used:* {{ $json.discount_used }}\\n*Recovery Time:* {{ $json.recovery_time_hours }} hours\\n\\nðŸ’° Another successful recovery!",
        "otherOptions": {}
      },
      "id": "notify-conversion",
      "name": "Notify Conversion",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1120, 800],
      "credentials": {
        "slackApi": {
          "id": "slack-api",
          "name": "Slack API"
        }
      }
    },
    {
      "parameters": {
        "content": "## Abandoned Cart Recovery\\n\\n**Recover lost revenue automatically!**\\n\\nðŸ›’ **Cart Detection:**\\nâœ… Shopify abandoned checkouts\\nâœ… WooCommerce pending orders\\nâœ… 15-minute check interval\\nâœ… 1+ hour abandonment threshold\\n\\nðŸ¤– **AI-Powered Recovery:**\\nâœ… Customer segmentation\\nâœ… Dynamic discount calculation\\nâœ… Personalized messaging\\nâœ… Product recommendations\\nâœ… Urgency optimization\\n\\nðŸ“§ **Multi-Channel Outreach:**\\nâœ… Personalized emails (HTML)\\nâœ… WhatsApp messages\\nâœ… 24-hour urgency\\nâœ… Unique discount codes\\n\\nðŸ“Š **Conversion Tracking:**\\nâœ… Recovery monitoring\\nâœ… Revenue tracking\\nâœ… ROI analytics\\nâœ… Team notifications\\n\\nðŸ’° **Business Value:**\\n- Recover 15-30% of abandoned carts\\n- $10,000-50,000/month in recovered revenue\\n- Zero manual work\\n- Personalized at scale\\n\\n**Perfect for:**\\n- E-commerce stores\\n- High cart abandonment\\n- $50+ average order value",
        "height": 600,
        "width": 380
      },
      "id": "sticky-note",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [240, 1000]
    }
  ],
  "connections": {
    "Abandoned Cart Checker": {
      "main": [
        [
          {
            "node": "Fetch Shopify Abandoned Carts",
            "type": "main",
            "index": 0
          },
          {
            "node": "Fetch WooCommerce Pending Orders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Shopify Abandoned Carts": {
      "main": [
        [
          {
            "node": "Normalize Cart Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch WooCommerce Pending Orders": {
      "main": [
        [
          {
            "node": "Normalize Cart Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize Cart Data": {
      "main": [
        [
          {
            "node": "Check if Already Tracked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Already Tracked": {
      "main": [
        [
          {
            "node": "Is New Abandoned Cart?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is New Abandoned Cart?": {
      "main": [
        [
          {
            "node": "AI Cart Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Cart Analysis": {
      "main": [
        [
          {
            "node": "Calculate Dynamic Discount",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculate Dynamic Discount": {
      "main": [
        [
          {
            "node": "Generate Recovery Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "Generate WhatsApp Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Recovery Email": {
      "main": [
        [
          {
            "node": "Merge Message Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate WhatsApp Message": {
      "main": [
        [
          {
            "node": "Merge Message Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Message Content": {
      "main": [
        [
          {
            "node": "Send Recovery Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send WhatsApp Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Recovery Email": {
      "main": [
        [
          {
            "node": "Save Cart Recovery Record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send WhatsApp Message": {
      "main": [
        [
          {
            "node": "Save Cart Recovery Record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Cart Recovery Record": {
      "main": [
        [
          {
            "node": "Notify Team",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Conversion Tracker": {
      "main": [
        [
          {
            "node": "Get Contacted Carts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Contacted Carts": {
      "main": [
        [
          {
            "node": "Check Conversions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Conversions": {
      "main": [
        [
          {
            "node": "Update Recovered Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Recovered Status": {
      "main": [
        [
          {
            "node": "Notify Conversion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "id": "cart-recovery",
      "name": "Cart Recovery"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-01-08T00:00:00.000Z",
  "versionId": "1.0.0"
}
